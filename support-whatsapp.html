<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hubungi Kami â€¢ WhatsApp Style</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    * {
      -webkit-tap-highlight-color: transparent; /* ðŸš« hilangkan highlight biru mobile */
      user-select: none; /* ðŸš« teks tidak bisa di-select/hold biru */
    }
    a {
      text-decoration: none;
      color: inherit;
    }
    body {
      margin:0;
      font-family:'Poppins',sans-serif;
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:#0a0a0a;
    }
    .chat-container {
      width:100%;
      max-width:420px;
      height:600px;
      background:#e5ddd5;
      border-radius:12px;
      box-shadow:0 6px 20px rgba(0,0,0,.4);
      display:flex;
      flex-direction:column;
      overflow:hidden;
      animation:fadeInUp .6s ease;
    }
    @keyframes fadeInUp {
      from{transform:translateY(30px);opacity:0;}
      to{transform:translateY(0);opacity:1;}
    }
    .chat-header {
      background:#075e54;
      color:#fff;
      padding:10px 14px;
      font-weight:600;
      font-size:16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .chat-header-left {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .chat-header img {
      width:36px;
      height:36px;
      border-radius:50%;
      border:2px solid #fff3;
    }
    .chat-header button {
      background:transparent;
      border:none;
      color:#fff;
      cursor:pointer;
      font-size:14px;
    }
    .chat-body {
      flex:1;
      padding:12px;
      overflow-y:auto;
      background:url('https://i.ibb.co/hm3yQhF/whatsapp-bg.png');
      background-size:cover;
    }
    .bubble {
      margin:6px 0;
      max-width:75%;
      padding:8px 12px 16px;
      border-radius:8px;
      font-size:14px;
      position:relative;
      word-wrap:break-word;
      box-shadow:0 2px 4px rgba(0,0,0,.2);
      cursor:pointer;
      transition: transform .1s ease;
      opacity:0;
    }
    .bubble.me {
      background:#dcf8c6;
      margin-left:auto;
      border-bottom-right-radius:0;
      animation:slideInRight .25s forwards;
    }
    .bubble.other {
      background:#fff;
      margin-right:auto;
      border-bottom-left-radius:0;
      animation:slideInLeft .25s forwards;
    }
    @keyframes slideInRight {
      from{transform:translateX(40px);opacity:0;}
      to{transform:translateX(0);opacity:1;}
    }
    @keyframes slideInLeft {
      from{transform:translateX(-40px);opacity:0;}
      to{transform:translateX(0);opacity:1;}
    }
    .bubble:active {
      transform: scale(0.95); /* efek press */
    }
    .time {
      font-size:11px;
      color:#555;
      position:absolute;
      bottom:2px;
      right:28px;
      opacity:.7;
    }
    .tick {
      position:absolute;
      bottom:2px;
      right:6px;
      font-size:12px;
      color:#555;
    }
    .tick.read {color:#34b7f1;}
    .chat-footer {
      display:flex;
      padding:10px;
      background:#f0f0f0;
      border-top:1px solid #ddd;
    }
    .chat-footer input {
      flex:1;
      padding:10px 14px;
      border-radius:20px;
      border:1px solid #ccc;
      outline:none;
      font-size:14px;
    }
    .chat-footer button {
      background:#075e54;
      border:none;
      color:#fff;
      padding:10px 15px;
      margin-left:8px;
      border-radius:50%;
      cursor:pointer;
    }
    .chat-footer button:hover{background:#128c7e;}

    /* context menu */
    .context-menu {
      position:absolute;
      background:#fff;
      border:1px solid #ccc;
      border-radius:6px;
      box-shadow:0 2px 6px rgba(0,0,0,.2);
      display:none;
      z-index:999;
    }
    .context-menu button {
      background:none;
      border:none;
      padding:8px 12px;
      width:100%;
      text-align:left;
      cursor:pointer;
    }
    .context-menu button:hover {background:#eee;}

    /* typing indicator */
    .typing {
      display:flex;
      gap:3px;
      padding:6px 10px;
      background:#fff;
      border-radius:12px;
      width:50px;
      margin:6px 0;
      margin-right:auto;
    }
    .dot {
      width:6px; height:6px;
      background:#888;
      border-radius:50%;
      animation:blink 1s infinite;
    }
    .dot:nth-child(2){animation-delay:.2s;}
    .dot:nth-child(3){animation-delay:.4s;}
    @keyframes blink {
      0%,80%,100%{opacity:.2;}
      40%{opacity:1;}
    }

    /* modal konfirmasi */
    .modal-overlay {
      position:fixed;
      top:0;left:0;
      width:100%;height:100%;
      background:rgba(0,0,0,.6);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:1000;
    }
    .modal {
      background:#fff;
      padding:20px;
      border-radius:10px;
      max-width:300px;
      text-align:center;
      animation:zoomIn .3s ease;
    }
    .modal h3 {
      margin-top:0;
      font-size:16px;
      color:#333;
    }
    .modal button {
      margin:10px 8px 0;
      padding:8px 16px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
    }
    .modal .cancel {background:#ddd;}
    .modal .confirm {background:#d9534f;color:#fff;}
    @keyframes zoomIn {
      from{transform:scale(.8);opacity:0;}
      to{transform:scale(1);opacity:1;}
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <div class="chat-header-left">
        <img src="assets/images/my-avatar.png" alt="Admin">
        <span>Admin Support</span>
      </div>
      <button id="clearAll">Hapus Semua</button>
    </div>
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-footer">
      <input type="text" id="chatInput" placeholder="Ketik pesan..." />
      <button id="chatSend">âž¤</button>
    </div>
  </div>

  <!-- context menu -->
  <div id="contextMenu" class="context-menu">
    <button id="deleteMe">Hapus untuk saya</button>
    <button id="deleteAll">Hapus untuk semua</button>
  </div>

  <!-- modal konfirmasi -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <h3>Hapus semua pesan?</h3>
      <button class="cancel" id="cancelClear">Batal</button>
      <button class="confirm" id="confirmClear">Hapus</button>
    </div>
  </div>

  <!-- suara notifikasi -->
  <audio id="notifSound">
    <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
  </audio>

<script>
  const chatBody=document.getElementById('chatBody');
  const chatInput=document.getElementById('chatInput');
  const chatSend=document.getElementById('chatSend');
  const contextMenu=document.getElementById('contextMenu');
  const deleteMeBtn=document.getElementById('deleteMe');
  const deleteAllBtn=document.getElementById('deleteAll');
  const clearAllBtn=document.getElementById('clearAll');
  const notifSound=document.getElementById('notifSound');
  const modalOverlay=document.getElementById('modalOverlay');
  const cancelClear=document.getElementById('cancelClear');
  const confirmClear=document.getElementById('confirmClear');
  let targetBubble=null;

  const TELEGRAM_TOKEN="8312704011:AAHA3KgfP4Ha8Fjo3LzpjAdSJRFg7dPZtT0";
  const TELEGRAM_CHATID="-1003080528675";

  let userId=localStorage.getItem("chatUserId");
  if(!userId){
    userId="U"+Date.now()+Math.floor(Math.random()*1000);
    localStorage.setItem("chatUserId",userId);
  }

  let chatHistory=JSON.parse(localStorage.getItem("chatHistory_"+userId)||"[]");
  chatHistory.forEach(m=>appendChat(m.text,m.who,false,m.time,m.status,m.msgId));

  function getTime(){
    const d=new Date();
    return d.getHours().toString().padStart(2,'0')+":"+
           d.getMinutes().toString().padStart(2,'0');
  }

  function appendChat(text,who='me',save=true,time=null,status='sent',msgId=null){
    const b=document.createElement('div');
    b.className='bubble '+(who==='me'?'me':'other');
    b.dataset.index=chatHistory.length;
    if(msgId) b.dataset.msgId=msgId;
    b.textContent=text;

    const t=document.createElement('span');
    t.className='time';
    t.textContent=time||getTime();
    b.appendChild(t);

    if(who==='me'){ 
      const tick=document.createElement('span');
      tick.className='tick';
      tick.innerHTML=status==='read'?'âœ”âœ”':status==='delivered'?'âœ”âœ”':'âœ”';
      if(status==='read'){tick.classList.add('read');}
      b.appendChild(tick);
    }

    b.addEventListener("contextmenu",e=>{
      e.preventDefault();
      targetBubble=b;
      contextMenu.style.display="block";
      contextMenu.style.left=e.pageX+"px";
      contextMenu.style.top=e.pageY+"px";
    });

    chatBody.appendChild(b);
    chatBody.scrollTop=chatBody.scrollHeight;

    if(save){
      chatHistory.push({text,who,time:t.textContent,status,msgId});
      localStorage.setItem("chatHistory_"+userId,JSON.stringify(chatHistory));
    }
  }

  async function sendChat(){
    const text=chatInput.value.trim();
    if(!text) return;
    appendChat(text,'me',true,null,'sent',null);
    chatInput.value="";

    try{
      const msg=`[${userId}] ${text}`;
      const res=await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({chat_id:TELEGRAM_CHATID,text:msg})
      });
      const data=await res.json();
      if(data.ok){
        updateLastTick('delivered');
        chatHistory[chatHistory.length-1].msgId=data.result.message_id;
        localStorage.setItem("chatHistory_"+userId,JSON.stringify(chatHistory));
        chatBody.querySelectorAll('.bubble.me')[chatBody.querySelectorAll('.bubble.me').length-1]
          .dataset.msgId=data.result.message_id;
      }
    }catch(e){console.warn("Gagal kirim",e);}
  }

  function updateLastTick(status){
    const bubbles=chatBody.querySelectorAll('.bubble.me');
    if(bubbles.length){
      const last=bubbles[bubbles.length-1];
      const tick=last.querySelector('.tick');
      if(status==='delivered'){tick.innerHTML='âœ”âœ”'; tick.classList.remove('read');}
      if(status==='read'){tick.innerHTML='âœ”âœ”'; tick.classList.add('read');}
      chatHistory[chatHistory.length-1].status=status;
      localStorage.setItem("chatHistory_"+userId,JSON.stringify(chatHistory));
    }
  }

  chatSend.addEventListener("click",sendChat);
  chatInput.addEventListener("keydown",e=>{
    if(e.key==="Enter"){e.preventDefault();sendChat();}
  });

  // Animasi admin mengetik
  function showTyping(){
    const typing=document.createElement('div');
    typing.className='typing';
    typing.innerHTML='<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
    chatBody.appendChild(typing);
    chatBody.scrollTop=chatBody.scrollHeight;
    return typing;
  }

  // Polling balasan admin
  let lastUpdateId=0;
  async function getUpdates(){
    try{
      const res=await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/getUpdates?offset=${lastUpdateId+1}`);
      const data=await res.json();
      if(data.result){
        data.result.forEach(up=>{
          lastUpdateId=up.update_id;
          if(up.message && up.message.chat.id.toString()===TELEGRAM_CHATID.toString()){
            const text=up.message.text;
            if(text && text.startsWith(`[${userId}]`)){
              const clean=text.replace(`[${userId}]`,"").trim();
              const typing=showTyping();
              setTimeout(()=>{
                typing.remove();
                appendChat(clean,"other");
                updateLastTick('read');
                notifSound.play();
              },1200);
            }
          }
        });
      }
    }catch(err){console.error(err);}
  }
  setInterval(getUpdates,2000);

  // Delete hanya di user
  deleteMeBtn.addEventListener("click",()=>{
    if(targetBubble){
      const idx=targetBubble.dataset.index;
      targetBubble.textContent="Pesan ini telah dihapus";
      targetBubble.style.fontStyle="italic";
      const t=targetBubble.querySelector('.time'); if(t) t.remove();
      const k=targetBubble.querySelector('.tick'); if(k) k.remove();
      if(chatHistory[idx]){
        chatHistory[idx].text="Pesan ini telah dihapus";
      }
      localStorage.setItem("chatHistory_"+userId,JSON.stringify(chatHistory));
      targetBubble=null;
      contextMenu.style.display="none";
    }
  });

  // Delete untuk semua
  deleteAllBtn.addEventListener("click",async()=>{
    if(targetBubble){
      const idx=targetBubble.dataset.index;
      const msgId=targetBubble.dataset.msgId;
      targetBubble.textContent="Pesan ini telah dihapus untuk semua";
      targetBubble.style.fontStyle="italic";
      const t=targetBubble.querySelector('.time'); if(t) t.remove();
      const k=targetBubble.querySelector('.tick'); if(k) k.remove();
      if(chatHistory[idx]){
        chatHistory[idx].text="Pesan ini telah dihapus untuk semua";
      }
      localStorage.setItem("chatHistory_"+userId,JSON.stringify(chatHistory));
      if(msgId){
        try{
          await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/deleteMessage?chat_id=${TELEGRAM_CHATID}&message_id=${msgId}`);
        }catch(e){console.warn("Gagal hapus",e);}
      }
      targetBubble=null;
      contextMenu.style.display="none";
    }
  });

  // Hapus semua pesan (pakai modal)
  clearAllBtn.addEventListener("click",()=>{
    modalOverlay.style.display="flex";
  });
  cancelClear.addEventListener("click",()=>{
    modalOverlay.style.display="none";
  });
  confirmClear.addEventListener("click",()=>{
    chatHistory=[];
    localStorage.removeItem("chatHistory_"+userId);
    chatBody.innerHTML="";
    modalOverlay.style.display="none";
  });

  document.addEventListener("click",()=>{contextMenu.style.display="none";});
</script>
</body>
</html>
